<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>静态路由联动bfd-echo解决路由ecmp问题</title>
    <link href="/2024/02/11/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E8%81%94%E5%8A%A8bfd-echo%E8%A7%A3%E5%86%B3%E8%B7%AF%E7%94%B1ecmp%E9%97%AE%E9%A2%98/"/>
    <url>/2024/02/11/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E8%81%94%E5%8A%A8bfd-echo%E8%A7%A3%E5%86%B3%E8%B7%AF%E7%94%B1ecmp%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h3 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h3><ul><li>DSW上联CSW，现有架构口子型上联，因业务流量增长，需进行上联扩容</li><li>网络拓扑<img src="/2024/02/11/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E8%81%94%E5%8A%A8bfd-echo%E8%A7%A3%E5%86%B3%E8%B7%AF%E7%94%B1ecmp%E9%97%AE%E9%A2%98/%E9%9D%99%E6%80%81%E8%B7%AF%E7%94%B1%E8%81%94%E5%8A%A8bfd.png" class="" title="拓扑"></li><li>路由介绍<ul><li>ASW–DSW通过EBGP三层对接，DSW学习到的EBGP路由做PBR&#x2F;路由策略重定向下一跳地址到CSW</li><li>DSW–CSW静态路由三层对接</li></ul></li></ul><h3 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h3><ul><li>新增扩容线路后，路由不会ECMP，做PBR&#x2F;路由策略重定向下一跳地址到CSW这部分路由只会跑原有线路</li></ul><h3 id="原因"><a href="#原因" class="headerlink" title="原因"></a>原因</h3><ul><li>PBR&#x2F;路由策略不能直接定向2个下一跳地址</li></ul><h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><ul><li>可通过配置静态路由联动bfd echo解决<ul><li>新增扩容线路三层、bfd对接</li><li>新增一个重定向地址，写2条目的地址指向重定向IP的静态路由联动bfd echo</li></ul></li><li>具体命令实施<ul><li>bfd echo 配置 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs stylus">bfd <span class="hljs-number">1</span> bind peer-ip X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span> interface X source-ip X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span> one-arm-echo<br>discriminator local <span class="hljs-number">1</span><br>bfd <span class="hljs-number">2</span> bind peer-ip X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span> interface X source-ip X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span> one-arm-echo<br>discriminator local <span class="hljs-number">2</span><br></code></pre></td></tr></table></figure></li><li>静态路由配置 <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs stylus">ip route-static X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span>.X（重定向IP） <span class="hljs-number">255.255</span>.<span class="hljs-number">255.255</span> 下一跳端口 X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span>  track bfd-session <span class="hljs-number">1</span>  description To_CSW_1<br>ip route-static X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span>.X（重定向IP） <span class="hljs-number">255.255</span>.<span class="hljs-number">255.255</span> 下一跳端口 X<span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span><span class="hljs-selector-class">.X</span>  track bfd-session <span class="hljs-number">2</span>  description To_CSW_2<br></code></pre></td></tr></table></figure></li><li>PBR&#x2F;路由策略重定向下一跳地址 <figure class="highlight tp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs tp">route-policy <span class="hljs-keyword">X</span> permit node <span class="hljs-number">500</span><br>  apply ip-address next-hop <span class="hljs-keyword">X</span>.<span class="hljs-keyword">X</span>.<span class="hljs-keyword">X</span>.<span class="hljs-keyword">X</span>（重定向IP）<br><br>traffic behavior <span class="hljs-keyword">X</span><br>  redirect nexthop <span class="hljs-keyword">X</span>.<span class="hljs-keyword">X</span>.<span class="hljs-keyword">X</span>.<span class="hljs-keyword">X</span>（重定向IP）<br></code></pre></td></tr></table></figure></li></ul></li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  <entry>
    <title>常用诊断命令汇总</title>
    <link href="/2024/02/09/%E5%B8%B8%E7%94%A8%E8%AF%8A%E6%96%AD%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/"/>
    <url>/2024/02/09/%E5%B8%B8%E7%94%A8%E8%AF%8A%E6%96%AD%E5%91%BD%E4%BB%A4%E6%B1%87%E6%80%BB/</url>
    
    <content type="html"><![CDATA[<h2 id="华三交换机常用命令汇总"><a href="#华三交换机常用命令汇总" class="headerlink" title="华三交换机常用命令汇总"></a>华三交换机常用命令汇总</h2><h3 id="设备类型"><a href="#设备类型" class="headerlink" title="设备类型"></a>设备类型</h3><ul><li>dis device manuinfo  &#x2F;&#x2F;查看设备型号、SN</li><li>dis version  &#x2F;&#x2F;查看设备版本补丁、重启时间</li></ul><h3 id="端口类型"><a href="#端口类型" class="headerlink" title="端口类型"></a>端口类型</h3><ul><li>dis int brief  &#x2F;&#x2F;查看设备端口状态</li><li>dis int brief description  &#x2F;&#x2F; 查看设备端口描述信息</li><li>dis transceiver int Ten-GigabitEthernetX&#x2F;X&#x2F;X  &#x2F;&#x2F;查看设备端口光模块信息</li><li>dis transceiver diagnosis int Ten-GigabitEthernetX&#x2F;X&#x2F;X  &#x2F;&#x2F;查看设备端口光功率详细信息</li></ul><h3 id="日志类型"><a href="#日志类型" class="headerlink" title="日志类型"></a>日志类型</h3><ul><li>dis logbuffer reverse  &#x2F;&#x2F;查看设备近期log信息</li><li>dis logbuffer size XX  &#x2F;&#x2F;查看设备近XX条log信息</li></ul><h3 id="lacp常用诊断命令"><a href="#lacp常用诊断命令" class="headerlink" title="lacp常用诊断命令"></a>lacp常用诊断命令</h3><ul><li>dis link-aggregation verbose Bridge-Aggregation X  &#x2F;&#x2F;查看X聚合组聚合情况、system id、优先级等详细信息</li><li>dis link-aggregation member-port Ten-GigabitEthernet X  &#x2F;&#x2F;查看X端口的lacp报文收发情况</li></ul><h3 id="irf相关查询命令"><a href="#irf相关查询命令" class="headerlink" title="irf相关查询命令"></a>irf相关查询命令</h3><ul><li>dis irf  &#x2F;&#x2F;查看irf堆叠信息</li><li>dis irf configuration  &#x2F;&#x2F;查看irf堆叠端口配置信息</li></ul><h3 id="drni相关查询命令"><a href="#drni相关查询命令" class="headerlink" title="drni相关查询命令"></a>drni相关查询命令</h3><ul><li>dis drni keepalive  &#x2F;&#x2F;查看keepalive详细信息</li><li>dis drni role  &#x2F;&#x2F;查看drni主备信息</li><li>dis drni summary  &#x2F;&#x2F;查看设备drni汇总信息</li></ul><h3 id="路由相关命令"><a href="#路由相关命令" class="headerlink" title="路由相关命令"></a>路由相关命令</h3><ul><li>dis ip routing-table  &#x2F;&#x2F;查看IP路由表</li><li>dis ip routing-table vpn-instance X  &#x2F;&#x2F;查看对应X vrf的路由表</li><li>dis ip routing-table summary  &#x2F;&#x2F;查看路由汇总信息</li><li>dis ip routing-table protocol X  &#x2F;&#x2F;查看对应详细路由协议的路由表信息</li><li>dis bgp routing-table ipv4 unicast  &#x2F;&#x2F;查看bgp路由表信息</li><li>dis bgp routing-table ipv4 unicast peer X.X.X.X received-routes  &#x2F;&#x2F;查看从BGP邻居接受到的bgp路由信息</li></ul><h2 id="华为交换机常用命令汇总"><a href="#华为交换机常用命令汇总" class="headerlink" title="华为交换机常用命令汇总"></a>华为交换机常用命令汇总</h2><h3 id="设备类型-1"><a href="#设备类型-1" class="headerlink" title="设备类型"></a>设备类型</h3><ul><li>dis device manufacture-info  &#x2F;&#x2F;查看设备型号、SN</li><li>dis version  &#x2F;&#x2F;查看设备版本补丁、重启时间</li></ul><h3 id="端口类型-1"><a href="#端口类型-1" class="headerlink" title="端口类型"></a>端口类型</h3><ul><li>dis int brief  &#x2F;&#x2F;查看设备端口状态</li><li>dis int description  &#x2F;&#x2F; 查看设备端口描述信息</li><li>dis int 10GE 1&#x2F;0&#x2F;1 transceiver  &#x2F;&#x2F;查看设备端口光模块信息</li><li>dis int 10GE 1&#x2F;0&#x2F;1 transceiver verbose  &#x2F;&#x2F;查看设备端口光功率详细信息</li></ul><h3 id="日志类型-1"><a href="#日志类型-1" class="headerlink" title="日志类型"></a>日志类型</h3><ul><li>dis logbuffer   &#x2F;&#x2F;查看设备近期log信息</li><li>dis logbuffer size XX  &#x2F;&#x2F;查看设备近XX条log信息</li></ul><h3 id="lacp常用诊断命令-1"><a href="#lacp常用诊断命令-1" class="headerlink" title="lacp常用诊断命令"></a>lacp常用诊断命令</h3><ul><li>display  interface  Eth X  &#x2F;&#x2F;查看X聚合组聚合情况、system id、优先级等详细信息</li><li>dis lacp statistics eth-trunk  &#x2F;&#x2F;查看端口的lacp报文收发情况</li></ul><h3 id="stack相关查询命令"><a href="#stack相关查询命令" class="headerlink" title="stack相关查询命令"></a>stack相关查询命令</h3><ul><li>dis stack  &#x2F;&#x2F;查看irf堆叠信息</li><li>dis stack  configuration  &#x2F;&#x2F;查看irf堆叠端口配置信息</li></ul><h3 id="m-lag相关查询命令"><a href="#m-lag相关查询命令" class="headerlink" title="m-lag相关查询命令"></a>m-lag相关查询命令</h3><ul><li>dis dfs-group 1 m-lag  &#x2F;&#x2F;查看m-lag详细信息</li><li>dis dfs-group m-lag brief  &#x2F;&#x2F;查看设备m-lag端口信息</li></ul><h3 id="路由相关命令-1"><a href="#路由相关命令-1" class="headerlink" title="路由相关命令"></a>路由相关命令</h3><ul><li>dis ip routing-table  &#x2F;&#x2F;查看IP路由表</li><li>dis ip routing-table vpn-instance X  &#x2F;&#x2F;查看对应X vrf的路由表</li><li>dis ip routing-table statistics  &#x2F;&#x2F;查看路由汇总信息</li><li>dis ip routing-table protocol X  &#x2F;&#x2F;查看对应详细路由协议的路由表信息</li><li>dis bgp routing-table   &#x2F;&#x2F;查看bgp路由表信息</li><li>dis bgp routing-table peer X.X.X.X received-routes  &#x2F;&#x2F;查看从BGP邻居接受到的bgp路由信息</li></ul><h2 id="cisco交换机常用命令汇总"><a href="#cisco交换机常用命令汇总" class="headerlink" title="cisco交换机常用命令汇总"></a>cisco交换机常用命令汇总</h2><h3 id="设备类型-2"><a href="#设备类型-2" class="headerlink" title="设备类型"></a>设备类型</h3><ul><li>show inventory  &#x2F;&#x2F;查看设备型号、SN</li><li>show version  &#x2F;&#x2F;查看设备版本补丁、重启时间</li></ul><h3 id="端口类型-2"><a href="#端口类型-2" class="headerlink" title="端口类型"></a>端口类型</h3><ul><li>show int brief  &#x2F;&#x2F;查看设备端口状态</li><li>show int description  &#x2F;&#x2F; 查看设备端口描述信息</li><li>show int ethernet 1&#x2F;1 transceiver  &#x2F;&#x2F;查看设备端口光模块信息</li><li>show int ethernet 1&#x2F;1 transceiver details  &#x2F;&#x2F;查看设备端口光功率详细信息</li></ul><h3 id="日志类型-2"><a href="#日志类型-2" class="headerlink" title="日志类型"></a>日志类型</h3><ul><li>show logging   &#x2F;&#x2F;查看设备近期log信息</li><li>show logging last XX  &#x2F;&#x2F;查看设备近XX条log信息</li></ul><h3 id="lacp常用诊断命令-2"><a href="#lacp常用诊断命令-2" class="headerlink" title="lacp常用诊断命令"></a>lacp常用诊断命令</h3><ul><li>show lacp port-channel interface port-channel 1  &#x2F;&#x2F;查看X聚合组聚合情况、system id、优先级等详细信息</li><li>show lacp counters  &#x2F;&#x2F;查看端口的lacp报文收发情况</li></ul><h3 id="vpc相关查询命令"><a href="#vpc相关查询命令" class="headerlink" title="vpc相关查询命令"></a>vpc相关查询命令</h3><ul><li>show vpc peer-keepalive  &#x2F;&#x2F;查看keepalive详细信息</li><li>show vpc role  &#x2F;&#x2F;查看drni主备信息</li><li>show vpc brief  &#x2F;&#x2F;查看设备drni汇总信息</li></ul><h3 id="路由相关命令-2"><a href="#路由相关命令-2" class="headerlink" title="路由相关命令"></a>路由相关命令</h3><ul><li>show ip route  &#x2F;&#x2F;查看IP路由表</li><li>show ip route vrf all   &#x2F;&#x2F;查看所有vrf的路由表</li><li>show ip route summary  &#x2F;&#x2F;查看路由汇总信息</li><li>show bgp ipv4 unicast   &#x2F;&#x2F;查看bgp路由表信息</li><li>show bgp ipv4 unicast neighbors X.X.X.X received-routes  &#x2F;&#x2F;查看从BGP邻居接受到的bgp路由信息</li></ul>]]></content>
    
    
    
  </entry>
  
  
  
  
</search>
